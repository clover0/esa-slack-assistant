# 概要
Slackで解決した会話をリアクション一つでesa記事化する機能。ナレッジの蓄積を促進する。

# 背景
Slackで質問が解決しても、その内容がesaに残らないことが多い。

- ユーザーがSlackで質問をしたが、参考にできる記事が見つからない
- 詳しい人がSlackで回答してくれて解決
- しかし、その会話はSlackだけで完結してしまい、esaには残らないことがほとんどである
- 別のユーザーが同様の質問をした際に同じプロセスが繰り返される

この課題を解決し、ナレッジが蓄積されていくサイクルを実現したい。

# 機能概要
Slackスレッドに `:esa:` リアクションをつけると、会話内容をもとにesa記事の下書き（WIP）を自動生成する。

# 処理フロー
1. ユーザーがSlackスレッドに `:esa:` リアクションをつける
2. Botがスレッド全体の会話を取得
3. 会話内容からカテゴリ・キーワードを生成（既存の仕組みを流用）
4. esaで類似記事を検索
5. Geminiが「この会話の内容をカバーする記事が既に存在するか」を判定
6. 判定結果に応じて返信:
   - **適切な既存記事あり**: 記事URLと、スレッドに含まれる追加情報があれば更新提案を返信
   - **なし**: WIP記事を作成して「下書きを作成しました: [URL]」と返信

## 既存記事がある場合の返信例
```
この記事がカバーしてそうです: [URL]

スレッドの会話には以下の追加情報がありそうです:
- ○○の場合は△△という対応が必要
- □□の設定も確認するとよい

記事への追記を検討してください。
```
※ 既存記事の直接更新は行わず、提案のみとする（人間が判断して更新）

# 仕様詳細

## トリガー
- `:esa:` カスタム絵文字へのリアクション
- 直感的に「esaに残したい」という意図が伝わる

## 誰が発動できるか
- 誰でもOK（スレッド参加者以外も可）
- 理由: 関係する記事を作りたい人が誰でも参加できるメリットを重視

## カテゴリ・タグの決め方
- 既存の `selectCategory` の仕組みを流用
- Geminiがesaのカテゴリ一覧と会話内容から適切なカテゴリを推測
- タグも会話内容からGeminiが抽出

## 記事タイトル
- Geminiが会話内容から生成

## 重複判定
- 毎回esaを検索し、Geminiが既存記事との重複を判定
- やや厳しめの基準: かなり内容が一致していないと「既存あり」にしない
- DBは使用せず、都度検索で判定

## 記事の状態
- WIP（下書き）で作成
- 人間がレビュー・編集してから公開する想定

# 必要な追加スコープ
- esa API: `write:post`（記事作成用）
- Slack: `reactions:read`（リアクション検知用）

# 設計方針: 人間とAIの協力
最初から完全自動化を目指さず、人間がレビュー・判断できる余地を残す。運用しながら自動化の範囲を広げていくイメージ

## 段階的な自動化イメージ
- **Phase 1（初期リリース）**: 記事作成はWIP、既存記事への更新は提案のみ
- **Phase 2（運用後）**: 信頼度が高いケースでは自動公開や自動追記を検討
- **Phase 3（将来）**: 完全自動でナレッジが育つサイクルを目指す
